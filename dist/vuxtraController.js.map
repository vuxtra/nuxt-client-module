{"version":3,"file":"vuxtraController.js","sources":["../lib/vuxtraController.js"],"sourcesContent":["import socketclusterClient from 'socketcluster-client'\nimport { ServiceRequest, ServiceResponse } from '@vuxtra/shared-core'\nimport _ from 'lodash'\n\nlet privateData = new WeakMap();\n\nvar $_internal\n\nexport default class VuxtraController {\n    constructor (options) {\n        this.socketclusterClient = socketclusterClient\n        this._internalRequestCounter = 1\n        this._internalSocketConnected = false\n        privateData.set(this, { options: options })\n        // privateData.get(this).options;\n        this.socket = this.socketclusterClient.connect({\n            port: options.port || 80,\n            hostname: options.hostname || 'localhost'\n        })\n        this.socket.on('connect', function () {\n            this._internalSocketConnected = true\n        });\n\n        let $_doBindOrExecute = (func) => {\n            if(this._internalSocketConnected !== true) {\n                this.socket.on('connect', () => {\n                    this._internalSocketConnected = true;\n                    func();\n                });\n            }\n            else {\n                func();\n            }\n        }\n\n        let $_internalService = ( callArguments, options, action ) => {\n            return new Promise((resolve, reject)  => {\n                $_doBindOrExecute(() => {\n                    let request = new ServiceRequest()\n                    request.setServiceName(options)\n                        .setServiceAction(action)\n                        .setData(callArguments)\n                        .setId(this.socket.id + this._internalRequestCounter)\n                    this._internalRequestCounter++\n                    this.socket.emit('service.call', request, function (err, res) {\n                        if (err) {\n                            reject(err)\n                        } else {\n                            let response = new ServiceResponse(res)\n                            resolve(response)\n                        }\n                    })\n\n                })\n            })\n        }\n\n        this.services = require('~/.vuxtra/clientVuxtra.js').services($_internalService, this)\n\n    }\n\n}"],"names":["privateData","WeakMap","VuxtraController","options","socketclusterClient","_internalRequestCounter","_internalSocketConnected","set","socket","connect","port","hostname","on","$_doBindOrExecute","func","$_internalService","callArguments","action","Promise","resolve","reject","request","ServiceRequest","setServiceName","setServiceAction","setData","setId","id","emit","err","res","response","ServiceResponse","services","require"],"mappings":";;;;;;;;;;;;;AAIA,IAAIA,cAAc,IAAIC,OAAJ,EAAlB;;AAEA,AAEe,MAAMC,gBAAN,CAAuB;gBACrBC,OAAb,EAAsB;aACbC,mBAAL,GAA2BA,mBAA3B;aACKC,uBAAL,GAA+B,CAA/B;aACKC,wBAAL,GAAgC,KAAhC;oBACYC,GAAZ,CAAgB,IAAhB,EAAsB,EAAEJ,SAASA,OAAX,EAAtB;;aAEKK,MAAL,GAAc,KAAKJ,mBAAL,CAAyBK,OAAzB,CAAiC;kBACrCN,QAAQO,IAAR,IAAgB,EADqB;sBAEjCP,QAAQQ,QAAR,IAAoB;SAFpB,CAAd;aAIKH,MAAL,CAAYI,EAAZ,CAAe,SAAf,EAA0B,YAAY;iBAC7BN,wBAAL,GAAgC,IAAhC;SADJ;;YAIIO,oBAAqBC,IAAD,IAAU;gBAC3B,KAAKR,wBAAL,KAAkC,IAArC,EAA2C;qBAClCE,MAAL,CAAYI,EAAZ,CAAe,SAAf,EAA0B,MAAM;yBACvBN,wBAAL,GAAgC,IAAhC;;iBADJ;aADJ,MAMK;;;SAPT;;YAYIS,oBAAoB,CAAEC,aAAF,EAAiBb,OAAjB,EAA0Bc,MAA1B,KAAsC;mBACnD,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAsB;kCACnB,MAAM;wBAChBC,UAAU,IAAIC,yBAAJ,EAAd;4BACQC,cAAR,CAAuBpB,OAAvB,EACKqB,gBADL,CACsBP,MADtB,EAEKQ,OAFL,CAEaT,aAFb,EAGKU,KAHL,CAGW,KAAKlB,MAAL,CAAYmB,EAAZ,GAAiB,KAAKtB,uBAHjC;yBAIKA,uBAAL;yBACKG,MAAL,CAAYoB,IAAZ,CAAiB,cAAjB,EAAiCP,OAAjC,EAA0C,UAAUQ,GAAV,EAAeC,GAAf,EAAoB;4BACtDD,GAAJ,EAAS;mCACEA,GAAP;yBADJ,MAEO;gCACCE,WAAW,IAAIC,0BAAJ,CAAoBF,GAApB,CAAf;oCACQC,QAAR;;qBALR;iBAPJ;aADG,CAAP;SADJ;;aAsBKE,QAAL,GAAgBC,QAAQ,2BAAR,EAAqCD,QAArC,CAA8ClB,iBAA9C,EAAiE,IAAjE,CAAhB;;;;;;;"}